<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gestión Arcane</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
          background-color: #f2f2f2;
          color: #333;
          margin: 0;
          padding: 20px;
        }
        h1 {
          text-align: center;
          background-color: #2c3e50;
          color: white;
          padding: 20px;
          border-radius: 8px;
        }
        section {
          background-color: white;
          border-radius: 8px;
          padding: 20px;
          margin-bottom: 30px;
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h2, h3 {
          color: #2c3e50;
        }
        form label {
          margin: 10px 0 5px;
        }
        input, select {
          padding: 8px;
          width: 100%;
          box-sizing: border-box;
          border: 1px solid #ccc;
          border-radius: 4px;
        }
        button {
          margin-top: 10px;
          padding: 10px;
          background-color: #3498db;
          color: white;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          font-weight: bold;
        }
        button:hover {
          background-color: #2980b9;
        }
        table {
          width: 100%;
          margin-top: 10px;
          border-collapse: collapse;
        }
        th, td {
          padding: 8px;
          border: 1px solid #ccc;
          text-align: left;
        }
        th {
          background-color: #34495e;
          color: white;
        }
        tr:nth-child(even) {
          background-color: #f9f9f9;
        }
    </style>
</head>
<body>
<h1>Gestión del universo Arcane</h1>


<section>
    <h2>Agregar Personaje</h2>
    <form id="formPersonaje">
        <label>Nombre: <input type="text" name="nombre" required></label>
        <label>Origen: <input type="text" name="origen" required></label>
        <label>Rol: <input type="text" name="rol" required></label>
        <label>Alineación: <input type="text" name="alineacion" required></label>
        <button type="submit">Guardar Personaje</button>
    </form>
    <h3>Listado de Personajes</h3>
    <table id="tablaPersonaje"><thead><tr><th>ID</th><th>Nombre</th><th>Origen</th><th>Rol</th><th>Alineación</th></tr></thead><tbody></tbody></table>
</section>

<section>
    <h2>Agregar Organización</h2>
    <form id="formOrganizacion">
        <label>Nombre: <input type="text" name="nombre" required></label>
        <label>Ciudad Base: <input type="text" name="ciudad_base" required></label>
        <label>Tipo: <input type="text" name="tipo" required></label>
        <button type="submit">Guardar Organización</button>
    </form>
    <h3>Listado de Organizaciones</h3>
    <table id="tablaOrganizacion"><thead><tr><th>ID</th><th>Nombre</th><th>Ciudad Base</th><th>Tipo</th></tr></thead><tbody></tbody></table>
</section>

<section>
    <h2>Agregar Tecnología</h2>
    <form id="formTecnologia">
        <label>Nombre: <input type="text" name="nombre" required></label>
        <label>Tipo: <input type="text" name="tipo" required></label>
        <label>Descripción: <input type="text" name="descripcion" required></label>
        <button type="submit">Guardar Tecnología</button>
    </form>
    <h3>Listado de Tecnologías</h3>
    <table id="tablaTecnologia"><thead><tr><th>ID</th><th>Nombre</th><th>Tipo</th><th>Descripción</th></tr></thead><tbody></tbody></table>
</section>

<section>
    <h2>Agregar Afiliación</h2>
    <form id="formAfiliacion">
        <label>ID Personaje: <input type="number" name="personaje" required></label>
        <label>ID Organización: <input type="number" name="organizacion" required></label>
        <label>Rol: <input type="text" name="rol" required></label>
        <label>Fecha de Ingreso: <input type="date" name="fecha_ingreso" required></label>
        <button type="submit">Guardar Afiliación</button>
    </form>
    <h3>Listado de Afiliaciones</h3>
    <table id="tablaAfiliacion"><thead><tr><th>ID</th><th>Personaje</th><th>Organización</th><th>Rol</th><th>Fecha Ingreso</th></tr></thead><tbody></tbody></table>
</section>

<section>
    <h2>Agregar Relación</h2>
    <form id="formRelacion">
        <label>ID Personaje A: <input type="number" name="personajeA" required></label>
        <label>ID Personaje B: <input type="number" name="personajeB" required></label>
        <label>Tipo de Relación: <input type="text" name="tipo_relacion" required></label>
        <button type="submit">Guardar Relación</button>
    </form>
    <h3>Listado de Relaciones</h3>
    <table id="tablaRelacion"><thead><tr><th>ID</th><th>Personaje A</th><th>Personaje B</th><th>Tipo de Relación</th></tr></thead><tbody></tbody></table>
</section>

<section>
    <h2>Agregar Uso de Tecnología</h2>
    <form id="formUsoTecnologia">
        <label>ID Personaje: <input type="number" name="personaje" required></label>
        <label>ID Tecnología: <input type="number" name="tecnologia" required></label>
        <button type="submit">Guardar Uso de Tecnología</button>
    </form>
    <h3>Listado de Usos de Tecnología</h3>
    <table id="tablaUsoTecnologia"><thead><tr><th>ID</th><th>Personaje</th><th>Tecnología</th></tr></thead><tbody></tbody></table>
</section>

<script>
    const endpoints = [
      { form: 'formPersonaje', url: 'http://localhost:8080/personaje', tabla: 'tablaPersonaje' },
      { form: 'formOrganizacion', url: 'http://localhost:8080/organizacion', tabla: 'tablaOrganizacion' },
      { form: 'formTecnologia', url: 'http://localhost:8080/tecnologia', tabla: 'tablaTecnologia' },
      { form: 'formAfiliacion', url: 'http://localhost:8080/afiliacion', tabla: 'tablaAfiliacion' },
      { form: 'formRelacion', url: 'http://localhost:8080/relacion', tabla: 'tablaRelacion' },
      { form: 'formUsoTecnologia', url: 'http://localhost:8080/usotecnologia', tabla: 'tablaUsoTecnologia' },
    ];

    async function cargarDatos(endpoint, tablaId) {
      const res = await fetch(endpoint);
      const data = await res.json();
      const tbody = document.querySelector(`#${tablaId} tbody`);
      tbody.innerHTML = '';
      data.forEach(obj => {
        const tr = document.createElement('tr');
        Object.values(obj).forEach(val => {
          const td = document.createElement('td');
          td.textContent = typeof val === 'object' && val !== null ? val.id || JSON.stringify(val) : val;
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
    }

    function manejarFormulario(formId, endpoint, tablaId) {
      const form = document.getElementById(formId);
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());
        Object.keys(data).forEach(k => {
          if (!isNaN(data[k]) && k !== 'rol') data[k] = parseInt(data[k]);
        });
        await fetch(endpoint, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        form.reset();
        cargarDatos(endpoint, tablaId);
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      endpoints.forEach(({ form, url, tabla }) => {
        manejarFormulario(form, url, tabla);
        cargarDatos(url, tabla);
      });
    });
</script>
</body>
</html>
